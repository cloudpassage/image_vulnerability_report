# Image Vulnerability Report
- **Image vulnerability report** script retrieves the whole list of container images along with CVEs and software packages details for every container image in the retrieved list.

- If HALO Portal has a long list of container images consists of more than **1K images**, then the script automatically convetered from being a single threading script into **multithreading** script in order to limit the script **running time** (i.e., if we have container images list consists of 20K image, then the script will instantiate **20 thread** to retrieve these 20K container images data).

- If the container images list containes more than 1K images, then the script will save every 1K images data into into a **separate csv file** (i.e., if we have 10K images, then the script should generate 10 CSV files containes details of the container images).

- Also, the script generates an **overall statistics CSV file** contains information like **Percentage of Vulnerable and Non-Vulnerable Images**, **Percentage of Critical and Non Critical CVEs**, and **Percentage of Vulnerable and Non-Vulnerable Software Packages**).

- Also, the script generates three **Pie charts** for visual representation of:
    - Percentage of Vulnerable and Non-Vulnerable Images.
    - Percentage of Critical and Non Critical CVEs.
    - Percentage of Vulnerable and Non-Vulnerable Software Packages

## Goal:
The main purpose of this script is to generate a report to retrieve the whole list of container images along with CVE and software packages details for every container image in the retrieved list. the script exports these results into external CSV files format.

## Requirements:
- CloudPassage Halo API key (with Auditor privileges).
- Python 3.6 or later including packages specified in "requirements.txt".

## Installation:
```
   git clone https://github.com/cloudpassage/image_vulnerability_report.git
   cd image_vulnerability_report
   pip install -r requirements.txt
```

## Configuration:
| Variable | Description | Default Value |
| -------- | ----- | ----- |
| HALO_API_KEY | ID of HALO API Key | ef\*\*ds\*\*fa |
| HALO_API_SECRET_KEY | Secret of HALO API Key | fgfg\*\*\*\*\*heyw\*\*\*\*ter352\*\*\* |
| HALO_API_HOSTNAME | Halo API Host Name | https://api.cloudpassage.com |
| HALO_API_PORT | Halo API Port Number | 443 |
| HALO_API_VERSION | HALO EndPoint Version | v2 |
| OUTPUT_DIRECTORY | Location for generated CSV files | /var/log |

## How the scripts works:
- Checking and validation of the provided configuration parameters and fails in case of missing any required parameter.
- Use HALO API key id/secret to generate access token to be used to access Protected HALO resources.
- Retrieving the whole list of container images along with CVEs and software packages details for every container images.
- Preparing image vulnerability report statistics (i.e. Percentage of Vulnerable and Non-Vulnerable Images, Percentage of Critical and Non Critical CVEs, and Percentage of Vulnerable and Non-Vulnerable Software Packages).
- Exporting all retreived image vulnerability report data of into CSV files format.
- Generate Pie Charts as a visual representation for the report overall statistics. 

## How to run the tool (stand-alone):
To run the script follow the below steps.

1.  Navigate to the app folder that contains module "runner.py", and run it

```
    cd image_vulnerability_report/app
    python runner.py
```

## Sample Results:

- Overall Statistics Report

![Alt text](./app/resources/image_vulnerability_statistics_report.PNG?raw=true "Report Overall Statistics Data")


- Container Images detailed Report

![Alt text](./app/resources/container_images_details.PNG?raw=true "Container Images detailed Report")


- Images Vulnerability Graph

![Alt text](./app/resources/sample_image_vulenrability_images-graph.png?raw=true "Images Vulnerability Graph")


- CVEs Criticality Graph

![Alt text](./app/resources/sample_image_vulenrability_cves-graph.png?raw=true "CVEs Criticality Graph")


- Software Packages Vulnerability Graph

![Alt text](./app/resources/sample_image_vulenrability_packages-graph.png?raw=true "Software Packages Vulnerability Graph")