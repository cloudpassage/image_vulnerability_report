from src import json_to_csv
from src import config_helper
from src import halo_api_caller
from src import utility
import sys
import os

SCRIPT_DIR = os.path.dirname(os.path.abspath(__file__))
sys.path.append(os.path.dirname(SCRIPT_DIR))


def test_pie_graph_plot(no_of_vulnerable_images, no_of_non_vulnerable_images, graph_absolute_path):
    utility.Utility.plot_pie_graph(
        no_of_vulnerable_images, no_of_non_vulnerable_images, graph_absolute_path)


def test_get_container_images_statistics():
    config = config_helper.ConfigHelper()
    halo_api_caller_obj = halo_api_caller.HaloAPICaller(config)
    halo_api_caller_obj.authenticate_client()
    no_of_container_images = halo_api_caller_obj.get_container_images_statistics()
    print("No of Container Images= %s" % (no_of_container_images[0]))


def test_get_image_CVEs(image_id):
    config = config_helper.ConfigHelper()
    halo_api_caller_obj = halo_api_caller.HaloAPICaller(config)
    halo_api_caller_obj.authenticate_client()
    image_CVEs_list = halo_api_caller_obj.get_image_CVEs(image_id)
    print(image_CVEs_list[0])


def test_get_image_software_packages(image_id):
    config = config_helper.ConfigHelper()
    halo_api_caller_obj = halo_api_caller.HaloAPICaller(config)
    halo_api_caller_obj.authenticate_client()
    image_software_packages_list = halo_api_caller_obj.get_image_software_packages(
        image_id)
    print(image_software_packages_list[0])


def test_get_container_images(page):
    config = config_helper.ConfigHelper()
    halo_api_caller_obj = halo_api_caller.HaloAPICaller(config)
    halo_api_caller_obj.authenticate_client()
    container_images_list = halo_api_caller_obj.get_container_images(
        page)
    print(container_images_list[0][1])


def test_insert_into_csv():
    json_to_csv_obj = json_to_csv.JSONToCSV()
    print(json_to_csv_obj.test_var)
